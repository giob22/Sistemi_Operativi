<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Monitor - IPC</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-cc69e1fb.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-56612340.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-c2b90f7e.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-18d1fdea.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">IPC</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="monitor"><a class="header" href="#monitor">Monitor</a></h1>
<p>Il <strong>monitor</strong> è una struttura sintattica che opera su una risorsa condivisa (shm) gestendone l’accesso e la sincronizzazione tra processi/thread concorrenti.</p>
<p>Un monitor abbina un insieme di <strong>operazioni</strong> ad una struttura dati (risorsa) condivisa tra processi.</p>
<p>Il costrutto monitor è <strong>sintatticamente</strong> simile al costrutto <em>class</em> ma è utilizzato per la gestione delle risorse condivise tra processi. Quindi non possiede risorse locali, come avviene per le classi, ma delle risorse condivise.</p>
<p>Il monitor stesso sarà una risorsa condivisa.</p>
<p>Lo scopo di un monitor è quello di facilitare la programmazione condivisa. Infatti permette di creare <strong>politiche di accesso</strong> alle risorse condivise tramite delle condizioni che implementeremo (<strong>variabili di condizione</strong>).</p>
<p align="center">
  <img src="images/politiche_accesso.png" width="300">
</p>

<p>Un monitor lo possiamo vedere quindi come <strong>tipo di dato astratto</strong> contenente variabili di condizione e procedure che implementano le politiche di accesso ad una risorsa condivisa (<code>shm</code>).</p>
<p>In <code>c</code> implementiamo un TDA proprio con una <code>struct</code> che porta con se il concetto di classe dove ogni membro è pubblico.</p>
<p align="center">
  <img src="images/MonitorTDA.png" width="300">
</p>

<ul>
<li>
<p><strong>Risorsa</strong>: consiste nella risorsa condivisa tra i vari processi che la competono;</p>
</li>
<li>
<p><strong>Stato della risorsa</strong>: consiste in altri variabili membro utili per la gestione come:</p>
<ul>
<li>puntatore di testa/coda;</li>
<li>pid dell’ultimo processo ad aver effettuato un modifica sulla <code>shm</code>;</li>
<li>…</li>
</ul>
</li>
<li>
<p><strong>Funzioni membro (pubbliche)</strong>: per accesso alla risorsa da parte dei processi, quindi procedure pubbliche;</p>
</li>
<li>
<p><strong>Funzioni membro (private)</strong>: per uso interno al monitor.</p>
</li>
</ul>
<h2 id="strategie-di-controllo"><a class="header" href="#strategie-di-controllo">Strategie di controllo</a></h2>
<p>La politica di accesso impone che:</p>
<ul>
<li><strong>un solo processo alla volta</strong> può avere accesso alla risorsa condivisa (<strong>competizione</strong>);</li>
<li>i processi devono seguire un determinato <strong>ordine di accesso alla risorsa</strong> (<strong>cooperazione</strong>).</li>
</ul>
<h3 id="competizione"><a class="header" href="#competizione">Competizione</a></h3>
<p>Quindi per il primo punto: le <strong>funzioni pubbliche</strong> del monitor sono esegute in modo <strong>mutuamente esclusivo</strong>.</p>
<p>Appunto perché queste funzioni operano sulla risorsa critica che viene condivisa tra i processi. Significa che per eseguire una qualsiasi operazione definita nel monitor un processo, a monte, deve chiedere l’accesso a quest’ultimo.</p>
<p align="center">
  <img src="images/accesso_monitor.png" width="300">
</p>

<p><code>m</code> è l’istanza di un monitor che gestisce l’accesso ad un risorsa critica. Quindi i processi per poter operare sulla <code>shm</code> chiamano una procedura di accesso definita dal monitor.</p>
<p>Nel caso il monitor sia già assegnato ad un altro processo, il processo che tenta di accedervi viene sospeso fin tanto che la risorsa monitor non viene rilasciata dal processo detentore.</p>
<p>Quindi in questo modo solo un processo per volta può avere accesso alla risorsa condivisa poiché l’accesso viene gestito dai metodi pubblici del monitor.</p>
<p><strong>Come implementare i metodi pubblici</strong> di un monitor?</p>
<p>Attraverso:</p>
<ul>
<li>
<p><strong>librerie di funzioni</strong> del linguaggio di programmazione</p>
<p>Dobbiamo implementare delle librerie ad <em>hoc</em> per complementare quello che ci offre il linguaggio di programmazione; per gestire poi la competizione e cooperazione.</p>
<p>In <code>c</code> implementiamo metoti come <code>enter()</code> e <code>leave_monitor()</code> per permettere l’operazione mutuamente esclusiva sulla risorsa;</p>
</li>
<li>
<p><strong>parole chiave</strong> del linguaggio di programmazione</p>
<p>Esempio chiave è <strong>JAVA</strong>, che utilizza un monitor implicito che attraverso la parola chiave <strong>Synchronize</strong> permette a metodi di esser eseguiti in maniera mutuamente esclusiva.</p>
</li>
</ul>
<pre><code class="language-c">Monitor M {
    void metodo1(){
        enter_monitor();
        // operazioni su risorsa
        leave_monitor();
    }
}
</code></pre>
<p>Per la competizione il monitor fa uso di semafori <strong>lock</strong> per gestire la mutua esclusione: per l’entrata sul monitor e l’uscita sul monitor.</p>
<h3 id="cooperazione"><a class="header" href="#cooperazione">Cooperazione</a></h3>
<p>Nella gestione della cooperazione, i processi si sospendono se <strong>non è verificata</strong> una “<strong>condizione logica</strong>” di accesso.</p>
<p>Per la gestione della cooperazione si introduce un tipo di variabile detta <strong>variabile condition</strong>, che determina la sospensione di un processo nel momento in cui una condizione non è verificata.</p>
<pre><code class="language-c">var_cond x;
</code></pre>
<p>Tale variabile condition definisce due metodi:</p>
<ul>
<li><code>x.wait_cond()</code> sospende il processo chiamante…</li>
<li>… fino a che un altro processo esegue <code>x.signal_cond()</code>.</li>
</ul>
<p>Simile ai semafori ma le operazioni <strong>hanno un comportamento diverso</strong>.</p>
<p>Avremo tante variabili condition quante sono le condizioni per cui un processo deve esser sospeso per cooperazione</p>
<p>→ ogni variabile condition è associata ad una condizione logica.</p>
<pre><code class="language-c">Monitor M {
    var_cond x;
    var_cond y;

    void metodo1(){
        enter_monitor();

        if/while(!condizione_logica) //tale condizione è legata a x
            x.wait_cond();
        // operazione su risorsa
        y.signal_cond();
        leave_monitor();
    }
}
</code></pre>
<p>Questo esempio potrebbe benissimo implementare il paradigma produttori/consumatori se associassimo ad <code>x</code> la condizione che riguarda lo spazio disponibile ed a <code>y</code> la condizione di messaggio disponibile.</p>
<p>Ovviamente nel momento in cui un processo viene sospeso, questo rilascia il monitor per permettere ad altri processi di entrare.</p>
<p>Nell’esempio è presente <code>if/while</code> perché ci sono diverse implementazioni possibili per l’operazione di <code>signal_cond()</code> che devono essere gestite in modo diverso.</p>
<p>Quindi per ottenere una corretta cooperazione tra processi e quindi un <strong>ordine di accesso</strong>:</p>
<ul>
<li>in ogni metodo del monitor, il processo chiamante controlla se è soddisfatta una <strong>condizione logica</strong>;</li>
<li>se la condizione non è soddisfatta, il processo chiamante viene <strong>sospeso</strong>;</li>
<li>nel momento in cui viene sospeso rilascia anche la risorsa monitor, in modo che un altro processo possa entrare ed eseguire operazioni che potrebbero portare alla sua sospensione oppure all’<strong>attivazione</strong> dei processi <strong>sospesi su una condizione</strong>.</li>
</ul>
<h2 id="monitor---paronamica"><a class="header" href="#monitor---paronamica">Monitor - paronamica</a></h2>
<p>Possiamo schematizzare un monitor in questo modo:</p>
<p align="center">
  <img src="images/panoramica_monitor.png" width="300">
</p>

<ul>
<li>Sono presenti diverse <strong>code</strong> in cui sono contenuti i processi che si sono sospesi e attendono si essere riattivati.</li>
<li>Procedure che un processo piò effettuare sulla <code>shm</code> in modo esclusivo.</li>
<li><strong>local data</strong> in cui sono contenute le strutture condivise.</li>
<li><strong>condition variables</strong> sono la sezione in cui sono dichiarate le variabili condition.</li>
</ul>
<p align="center">
  <img src="images/p1.png" width="300">
</p>

<p>Il processo entra nel monitor chiedendo di eseguire una procedura in mutua esclusione. Quindi dopo la chiamata alla procedura di interesse viene chiamata una <code>enter_monitor()</code>.</p>
<p>All’interno della procedura potrebbe esserci una condizione che potrebbe portare il processo a sospendersi nel caso in cui non sia verificata; condizioni associate a variabili condition.</p>
<p>→ Per ogni variabile condition oltre ad una condizione logica è associata una <strong>coda</strong> in cui saranno memorizzati tutti i processi che si sono sospesi per il mancato soddisfacimento della condizione logica.</p>
<p>Quindi nel momento in cui è da gestire una cooperazione le procedure controllano, tramite le variabili locali, se la <strong>condizione di sincronizzazione</strong> è valida (es. buffer vuoto, buffer occupato).</p>
<p>Se la <strong>condizione di sincronizzazione</strong> è valida, il processo completa l’esecuzione e libera il monitor con una chiamata <code>leave_monitor()</code>.</p>
<p>Condizione <strong>non</strong> valida:</p>
<p align="center">
  <img src="images/p2.png" width="300">
</p>

<p>Se al momento del controllo la <strong>condizione di sincronizzazione non è valida</strong>, il processo si sospende volontariamente usando la <strong>condition</strong> <strong>variables</strong> associata alla condizione che non è stata soddisfatta.</p>
<p>Mentre è in attesa, il monitor diventa libero, poiché il processo che si è sospeso deve aver rilasciato il monitor prima della sospensione con una <code>leave_monitor()</code>, e quindi è accessibile ad altri processi che attendono di entrare.</p>
<h2 id="note-su-condition-variables"><a class="header" href="#note-su-condition-variables">Note su condition variables</a></h2>
<hr>
<p style="font-size:1.3em; text-align:center;">
<b>var. condition</b> ≠ <b>semafori</b><br>
<b>wait_condition()</b> ≠ <b>wait_sem()</b><br>
<b>signal_condition()</b> ≠ <b>signal_sem()</b>
</p>

<hr>
<p>La <code>wait_cond()</code> <strong>sospende sempre il processo chiamante</strong>.</p>
<p>→ Nei semafori, con <code>wait_sem()</code>, la sospensione era <strong>condizionata</strong> allo stato interno del semaforo</p>
<p>La <code>signal_cond()</code> <strong>non ha alcun effetto</strong> se <strong>non vi è alcun processo in attesa</strong> sulla condition variables.</p>
<p>→ Nei semafori invece <code>signal_sem()</code> aveva sempre un effetto, ovvero quello di incrementare lo stato del semaforo.</p>
<h2 id="diverse-implementazioni-di-signal_cond-semantica"><a class="header" href="#diverse-implementazioni-di-signal_cond-semantica">Diverse implementazioni di <code>signal_cond()</code> (semantica)</a></h2>
<p>A fronte di questa problematica abbiamo diverse implementazioni della procedura <code>signal_cond()</code>.</p>
<p align="center">
  <img src="images/problemaSignal_cond.png" width="300">
</p>

<p>Supponiamo che <code>P</code> acceda al monitor e debba eseguire una procedura in mutua esclusione, ma <strong>non soddisfa</strong> una condizione definita per la cooperazione.</p>
<p>→ Il processo spontaneamente si sospense utilizzando <code>wait_cond()</code> sulla condition variables associata a tale condizione.</p>
<p>Nel momento in cui <code>P</code> si sospende questo rilascia la risorsa monitor agli altri processi in attesa. Quindi il prossimo processo schedulato in attesa, <code>Q</code>, entra nel monitor ed esegue una procedura che potrebbe comportare <strong>l’aggiornamento dello stato della risorsa</strong>.</p>
<p>→ La condizione di sincronizzazione che ha portato <code>P</code> a sospendersi viene soddisfatta, quindi tale processo può continuare la propria esecuzione</p>
<p>Il processo <code>Q</code> dopo la modifica che ha portato la risorsa ad essere pronta per <code>P</code>, riattiva <code>P</code> che ritorna pronto.</p>
<hr>
<p><strong>PROBLEMA:</strong> <code>P</code> e <code>Q</code> non possono eseguire entrambi nel monitor, si violerebbe la <strong>mutua esclusione</strong>.</p>
<hr>
<p>A questo problema <strong>non</strong> esiste una soluzione <strong>unica</strong>.</p>
<p>Diversi sistemi attribuiscono comportamenti (<strong>semantica</strong>) diversi alle primitive <code>wait_cond()</code>/<code>signal_cond()</code>.</p>
<h3 id="prima-soluzione-signal-and-wait"><a class="header" href="#prima-soluzione-signal-and-wait">Prima soluzione: signal and wait</a></h3>
<p><em><strong>signal_and_wait</strong></em> prevede:</p>
<ul>
<li>il processo segnalato <code>P</code> <strong>riprenda</strong> <strong>immediatamente</strong> l’esecuzione;</li>
<li>il processo segnalante <code>Q</code> venga <strong>sospeso</strong>.</li>
</ul>
<p><code>Q</code> viene sospeso per evitare che possa modificare nuovamente la condizione di sincronizzazione per cui <code>P</code> si è sospeso.</p>
<p>Utilizzo della primitiva <code>wait_cond()</code> in questa semantica di <code>signal_cond()</code>:</p>
<ul>
<li>il processo segnalato è il primo ad eseguire;</li>
<li>al risveglio, il segnalato <strong>ha certezza di trovare verificata</strong> la condizione di sincronizzazione, quindi non è necessario che questo la verifichi nuovamente.</li>
</ul>
<p>Quindi lo schema di uso della <code>wait_cond()</code> sarà:</p>
<pre><code class="language-c">if (!B) { // B = condizione di sincronizzazione
    cv.wait_cond(); // cv = var.condition, abbinata a B
}
// accesso alla risorsa...
</code></pre>
<p>In questo modo quando <code>P</code> entra per primo nel monitor, <strong>prematuramente</strong> (la condizione di sincronizzazione non è ancora valida), per cui si <strong>sospende</strong>.</p>
<p>Il processo <code>Q</code> <strong>opera sulla risorsa condivisa</strong> (es. buffer di stato) facendo in modo che venga soddisfatta la condizione di sincronizzazione, quindi effettua la <code>signal_cond()</code> sulla condition variable che comporta la sua sospensione.</p>
<p>Quindi <code>Q</code> dovrà uscire dalla risorsa monitor con una <code>leave_monitor()</code>.</p>
<p>→ <code>Q</code> attende l’uscira di <code>P</code> e <strong>compete</strong> con altri processi per rientrare nel monitor.</p>
<p align="center">
  <img src="images/signal_and_wait.png" width="300">
</p>

<hr>
<h4 id="signal_and_wait-di-hoare"><a class="header" href="#signal_and_wait-di-hoare">signal_and_wait di Hoare</a></h4>
<p>Una diversa soluzione di <strong>signal_and_wait</strong> potrebbe essere quella di <strong>Hoare</strong>.</p>
<p>In questa soluzione, il processo <code>Q</code> ha la precedenza sugli altri processi in attesa di entrare nel monitor.</p>
<p>Quindi <code>Q</code> non si sospende sulla coda in cui sono presenti tutti gli altri processi che sono in attesa, ma su una coda separata <strong>urgent_queue</strong>.</p>
<p align="center">
  <img src="images/wait_hoare.png" width="300">
</p>

<p>Tale soluzione di Hoare è un caso particolare di signal_and_wait, detta <strong>signal_and_urgent_wait</strong>.</p>
<p>Prevede che il processo <code>Q</code> abbia la <strong>priorità</strong> su ogni altri processi che intendono entrare nel monitor.</p>
<p>Questa soluzione si può ottenere sospendendo il processo <code>Q</code> dopo la <code>signal_wait()</code> su una cosa detta <em>urgent_queue</em>, separata dal mutex.</p>
<p>mutex: meccanismo di mutua escluzione che permette l’accesso al monitor ad un solo processo per volta.</p>
<h3 id="seconda-soluzione-signal-and-continue"><a class="header" href="#seconda-soluzione-signal-and-continue">Seconda soluzione: signal and continue</a></h3>
<p><em><strong>signal_and_continue</strong></em>:</p>
<ul>
<li>privilegia il processo <strong>segnalatore</strong> rispetto al <strong>segnalante</strong>;</li>
<li>il processo <code>Q</code> segnalatore prosegue la sua esecuzione, mantenendo l’accesso esclusivo al monitor.</li>
</ul>
<p>Quindi dopo il risvegli di <code>P</code> sospeso per il mancato soddisfacimento della condizione di sincronizzazione, questo viene nuovamente sospeso questa volta nella coda del mutex (insieme a tutti gli altri processi che in attesa di entrare nel monitor).</p>
<p>Per semplicità di implementazione il monitor signal-and-continue non usa la coda <strong>urgent</strong>.</p>
<p align="center">
  <img src="images/wait-continue.png" width="400">
</p>

<p>Essendo che <code>P</code> compete con gli altri processi per accedere al monitor potrebbe verificarsi la situazione in cui ad esser schedulato prima di <code>P</code> è <code>K</code>, che entra nel monitor una volra che <code>Q</code> lo ha rilasciato.</p>
<p>In qeusta sistuazione potrebbe accadere che <code>K</code> <strong>modifichi nuovamente la risorsa</strong> (le strutture contenute in <em>local data</em>) e quindi potrebbe far in modo che la condizione di sincronizzazione per <code>P</code> sia <strong>non più verificata</strong>.</p>
<p>Quindi è necessario che una volta che <code>P</code> rientri all’interno del monitor verifichi nuovamente la condizione di sincronizzazione.</p>
<p>→ Non abbiamo più la certezza che nel momento in cui <code>P</code> rientra nel monitor la condizione sia verificata.</p>
<p>Questo si può tradurre anche in una condizione di <strong>attesa indefinita</strong> per <code>P</code> (<strong>starvation</strong>).</p>
<p>Quindi in questo caso lo schema di uso della <code>wait_cond()</code> su una condition variable sarà:</p>
<pre><code class="language-c">while (!B) { // B = condizione di sincronizzazione
    cv.wait_cond(); // cv = condition variable associata a B
}
// in questo caso è possibili che wait_cond() venga chiamata più
// volte prima che P possa accedere alla risorsa
</code></pre>
<p><code>P</code> non ha la certezza che la condizione sia verificata, quindi deve controllare ogni volta che riottiene l’accesso al monitor.</p>
<h4 id="signal_all"><a class="header" href="#signal_all">signal_all</a></h4>
<p><code>signal_cond()</code> riattiva al più un solo processo.</p>
<p>Nel momento in cui si vuole risvegliare invece tutti i processi sospesi su una <strong>condition variable</strong> è possibili utilizzare la variante:</p>
<pre><code class="language-c">signal_all();
</code></pre>
<p>Tutti i processi risvegliati vengono messi nella <em>entry_queue</em>, dalla quale uno alla volta potraà rientrare nel monitor.</p>
<p align="center">
  <img src="images/signal_all.png" width="400">
</p>

<h3 id="confronto-signal-and-wait-vs-signal-and-continue"><a class="header" href="#confronto-signal-and-wait-vs-signal-and-continue">Confronto: signal-and-wait vs signal-and-continue</a></h3>
<p>La semantica di <em>signal-and-wait</em> richiede che venga chiamata <strong>precisamente quando il processo segnalato deve essere svegliato</strong>.</p>
<p>→ ovvero nel momento in cui è soddisfatta la condizione di sincronizzazione.</p>
<p>La semantica di <em>signal-and-continue</em> (e <em>signal-all</em>) è più <strong>robusta</strong>:</p>
<ul>
<li>il processo segnalante può chiamarla anche quando non è sicuro di se/quali processi risegliare;</li>
<li>saranno i processi risvegliati a controllare se possono eseguire, oppure sospensersi.</li>
</ul>
<h3 id="granularità-semaforo-vs-monitor"><a class="header" href="#granularità-semaforo-vs-monitor">Granularità: semaforo vs monitor</a></h3>
<p>Entrambi, sia monitor che semafori, sono dei concetti necessaria per la gestione di situazioni di cooperazione o competizione tra processi su una risorca condivisa.</p>
<p>Sono simili nell’utilizzo ma hanno tante differenza sia rispetto alla robustezza che alla granularità.</p>
<p>In particolar modo i semafori hanno una granularita <em>fine</em>, molto bassa, proprio perché gestiscono la mutua esclusione a <strong>livello di singole operazioni</strong>.</p>
<p>Mentre i monitor hanno una granularità più alta: il controllo non è sulla singola operazione sulla risorsa condivisa, ma sull’intera risorsa condivisa.</p>
<p>→ infatti nell’implementazione del problema produttori/consumatori con buffer di stato la modifica di questo a fine di un operazione (<code>IN_USO → OCCUPATO/LIBERO</code>), che sia di scrittura o lettura, deve essere eseguira all’interno del monitor (bloccando quindi gli altri processi che desiderano accedervi).</p>
<p>Mentre con i semafori la modifica sul buffer di stato <code>IN_USO → OCCUPATO/LIBERO</code> non era inclusa nella sezione critica, non ostacolavamo gli altri processi ad operare sulla risorsa.</p>
<p>Invece parlando di <strong>robustezza</strong> i monitor sono sicuramente molto più sicuri per via del loro <strong>livello di astrazione maggiore</strong>. Tutti le operazioni sulla memoria condivisa sono contenute all’interno del monitor. (possiamo dire che il monitor è un wrapper della <code>shm</code>)</p>
<p>Mentre per i semafori la gestione è esplicita, quindi è più alto il rischio di eventuali <strong>deadlock</strong>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Problema_lettori_scrittori.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="Monitor_implementazione_in_c.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Problema_lettori_scrittori.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="Monitor_implementazione_in_c.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
